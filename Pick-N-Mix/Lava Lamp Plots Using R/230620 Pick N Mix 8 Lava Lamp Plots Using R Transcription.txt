Jamie Whyte  
evening, everybody, so yes, so I am Jamie white. I'm one of the directors open at Manchester. And I've been involved with opening Manchester for not the full 10 years, but probably seven or eight years, kind of helping to run events and do some of the some of the consultancy work that we do with organisations around the world. So I'm also a kind of freelance data person. So I support government organisations, charities, companies, if they're if they're trying to do stuff with data, so I have been working with data most of my life, most of that in you know, using things like Excel over, you know, over kind of the past 20 years or so, but more recently, so over the past sort of three or four years, I've started to get into using r. so r is a statistical programming learning Which is really, really powerful in terms of manipulating data, and doing stuff with it. So I kind of done some stuff, some kind of, I guess, really, you'd call them hobby projects with open data, Manchester, where, you know, some of our goals have lit Manchester around, making sure that, that people have access to have the ability to understand the data that is being used to make decisions about them and the areas that they live in. And that's kind of where we're at as far as this this particular session is coming from is is around a piece of work that we did that kind of gained quite a lot of traction, got a lot of interest in, you know, in various communities, not just in Manchester, but you know, kind of spread around the country around something called the indices of deprivation. So, indices of deprivation are a data set that's published by the Ministry of housing communities. Local Government, and it's a data set that is every for four or five years it comes out. And it aggregates lots and lots of data sets about 40 different data sets about small areas around England. And, and scores those areas. So each of these areas has a population of about one and a half thousand people. And, and it scores them according to a range of factors from things like air quality, to road traffic accidents, to educational attainment and numbers of benefits claimants, life expectancy, sticks all these datasets together. And allows allows comparisons to be made about the relative deprivation of each area. So you can look at these, you can look at the data set and say that relatively one area is more deprived than another. And what that means is that means that the government has a data set that it can use to allocate funding. So it can say if it's if it has a pot of money that it wants to spend, particularly in more deprived areas. It has a data set that you can use to do that is quite often called the 1 billion pound data set. Because there's so much money that's that's allocated and not because they because it's an open data set, it means that other people can use that as well. So things like the lottery will use that when they're assessing applications for for bids for funding. And some of their some of their projects might have a deprivation criteria. So what we felt was we felt it was really important that people understood this, this data set and were able to use it to either evidence, you know, needs for that evidence, applications for grant funding, or evidence, you know, the need for projects that they run. So we started to do some stuff, we had a whole programme of events around the indices of deprivation, trying to explain it to people we go around salmon, and Julian go around to various community groups and help help kind of help scale them up on it. So one of the things that I did was to try and visualise the data in a way that was kind of a little bit less Sort of styled and just a table, something that's a bit more accessible to people. So I'm now going to attempt to share my screen and and we can get into this. So has that worked? Yeah. Okay, cool. So this was.

Jamie Whyte  
So there's a few have been a few different variations of this. But this is the, this is kind of the heart of it really. So this is these are our deprivation protocols. And they're variously called the deprivation profile poster, lava lamp plots, which is what I think they're called within the title of this talk. Some people call it their pants and Poor's plot because each of the shapes kind of looks like some of them are like skimpy pants, some luck, like sort of pre merges. But the basic principle is that this is a set of this is all the all the constituencies, all parliamentary constituencies in England. So using that deprivation data, the data gets matched up and there's a lot of kind of processing done to it. which ultimately allows me to draw these sorts of things. And what these what these shapes show is each shape is the deprivation profile of an area. So the more the wider the top of a shape is the the more kind of less deprived areas are are in a in a parliament constituency, the wider the base of the shape, the more more deprived areas there are in that particular constituency. So we can see that these are ranked according to to kind of overall deprivation so Wokingham might be sorry, is generally the least deprived parliamentary constituency in England. And if we go down to the other end of the scale, we can see that Liverpool Walton is the most deprived Parliament constituency in England. And these are all the ones that are in between. and then kind of, it's nice to be able to see these shapes and and be able to compare them because each one gives you a bit of a sense of of how each how each parliamentary constituency looks from a deprivation point. If you so to think has a kind of a big wide middle, which means that generally everybody is in, you know, a kind of a sort of similar deprivation. So, you know, they have kind of similar access to services that might everybody within their house has similar kind of, you know, health needs that kind of stuff. Whereas shape is more broad, you know, more like a piece of toast, fabrics in the mid Kent, there's a really good, really clear spread of people where there are people in there in the most deprived parts of the country relative to the country. And there are people who are in the least deprived as well. So it allows us to make you know, kind of quick, quick kind of assumptions about the makeup of an area. One of the things that kind of the interesting things that we did with this, the first the first iteration is very first iteration, this was coloured. The colours were done according to some kind of scale, which just was purely aesthetic. So it didn't kind of convey any information at all. It was just about, you know, making it look a certain way. What we did. To do though, was add in colours of the political party. So in this case, this is the Member of Parliament. So the the party of the Member of Parliament that that kind of represents that that parliamentary constituency and what you can see is a fairly clear sort of blue to red flow as the as those areas become sort of moved from the least deprived to the most deprived. And I think this in itself was quite an interesting when we put this out to people, people generally find it quite useful to get a good overall picture of, you know, of individual Parliament's conceptualism and being able to compare them to other areas. And, you know, we kind of did this for for other things. Also, for local authorities. I think we did one for Scotland as well. We did one for Wales, I think one for New Zealand, because they are they have similar data set. So each of these is kind of broadly similar, but putting them out there and really, they kind of They captured, they seem to capture the imaginations of a few different groups of people in quite large numbers. So the first of those was public health people. So what what seemed to be interesting was that there were quite a lot of quite a lot of interest from sort of directors of public health, and other other people involved in public health because it allowed them to kind of visualise deprivation in ways that they had not done before one of them one of the interesting ones was in Scotland, which is which compared Glasgow and Edinburgh, and I think generally, you know, they're two big cities in Scotland. And but they're very, very different in terms of the kind of the, you know, their situations. And these, these plots really showed that and I think that that really captured them. The second was teachers so teachers have kind of modern studies type things and and citizenship type stuff. Getting them getting nice to their students, was they found it to be really, really useful way of articulating how different areas different parts of the country are kind of facing facing different situations. Because the people in them, you know that the areas have, you know, have very different characteristics. So that's where this has come from. The the plan for this session now is just to show how we kind of get to get to this.

Jamie Whyte  
This diagram here, we're not actually going to get here because although a lot of the work in preparing this data and making it is done in our, there's, there's kind of a final step, which is done, which I've done in Adobe Illustrator, and there's no value, I think, in anybody watching me wrestle with illustrator for five days, trying to get it to do what I needed to do so. So we'll get it, we'll get it fairly close to this. But then, you know, the kind of the final step is, is taking on but what I'm hoping I think what we hoped from this session was that it would it will give people you know, hopefully a bit of an understanding of how, how, rather than just kind of default intellects out to do this kind of stuff, you know, to download data and do stuff with it. This is a bit of an alternative. If that, you know, just showing the benefits of it, maybe the stats show that it's not that complicated.

Jamie Whyte  
So I put the stuff up on on GitHub, so which is so so Rachel's session next week, then it's pretty timely. This is this is the GitHub repo, I'll put the link in the in the chat, you can clone this or you can download as a, you know, as a set of CSV files, you can take this away, and you can, you can run this and it should be Fingers crossed, it should be self contained. So you should be able to take this and just run it, and then you know, feel free to tweak it, you know, make some changes to it, use different data sets, you know, use different filters, all that kind of stuff. And, you know, kind of modify it. But what we'll do now is we'll work through and work through the script that we're going to use to get the data and then do stuff with. So that's what we're going to do. And so to do this, so we're gonna use r so r is I think I've already said it's a statistical programming language. So r in and of itself is an it's a command line. So use it in like terminal onset sh in on the Mac, I think windows shell or something in Windows and whatever that is, but the but you kind of run it from there, which is great for, you know, kind of super nerds. But I find that difficult I don't find it particularly intuitive. So somebody so there's an organisation built an integrated development environment with for it, which is called our studios. So this is our studio. So this makes it easier to do things in our because it kind of it helps with it helps with your sort of scripts and things. It gives you prompts, it's got integrated help, it's got a bit of file management, it's just generally a lot easier to do stuff. So that's what we're going to do today is a run through the scripts to produce those like to get the data, process it and then visualise it in our but using our studios I mean city that's so this is free for non commercial use. I think you can kind of go and have a look on the website. You can download it there's there's various kind of licencing options within But go and have a look at it and grab it, you might need to instal our as well as a separate thing. But the two to kind of link together really, really well. And so within this screen, this is the this is the screen you'll be faced with when you when you load it up, I got dark mode, obviously, you know, when you if you kind of use in our studio, you might have light mode enabled are no different settings. But broadly, this is that this is the arrangement. So we've got four four distinct panels. In the top left panel, we've got our kind of preview pane. So in here, this is where we've got, we can open our scripts, we can create our scripts in here. At the minute, we just got a blank script file. So there's nothing going on in there at the minute. But when we start to open things up when we start to create our objects and want to have a look at them. This is where we'll start to do that. This is the console. So we've gotten here, this is where we can so within a script we can build up a quite a complicated script that we can run. A console is a line by line, immediate runner of code So we can, we can put some put a like a line of code in here and run it, and it will just run it will do its thing, which is great, you know, for if you want to kind of test things out pretty quickly. But my kind of workflow tends to be that I avoid using the console wherever possible, and try and play everything scripts, just so that I know where it is, I can I can access it again, if I need to this bottom left panel here. So we've got a few different tabs here, one of which is the environment, or environments empty at the minute, because we've not done anything. As we start to create objects and load stuff into them, then we'll start to see this grow. And this is where we can start to access our stuff. We've got history so we can, we can see the history of all the stuff that we've done. If you've done something a while ago, and you think that you know, that works really well and you haven't saved it, then you might be able to get out of there. And then we've got connections. And so we're going to kind of ignore those for the purposes of this. And this bottom left pane, bottom right pane. Sorry, is we've got a few things going on here. So we've got our files. So we Got this, you can kind of view this in your normal File Explorer. But it's useful just to be able to access the stuff within the within the within our studio itself. Any plots that we make will go into here. And these are kind of additional packages or libraries that we've got installed installed to us with, with R. So that's one of the beauties of R is that if if something isn't included within the base, kind of set of set of functions, somebody will write them the right additional packages for it, just to make it easy to use to. And that's one of the things that we're going to do today is use a library a package called the tidy verse. So the tidy verse is a collection of functions and packages that are designed to make data science simpler. So this is about processing data. So it's about taking big, you know, big datasets, but taking data sets and doing things with them. So the kinds of steps that you want to do when you know you're kind of grabbing the data set. and explore it, if you want to match it with other datasets or you want to do filtering and all that kind of stuff, this, the tidy verse makes it easier to do that. So that's what we're what we're going to use today. We've also got this kind of integrated Help button here. So we can search for help across all sorts of things. And there's a viewer as well if you have only ever seen this in relation. So if I'm kind of rendering 3d objects, you know, 3d charts or, or maps or that kind of stuff, this is where this is where they will appear already. Sowhat I'm going to do is I'm going to load in a script. So this is a script that I've it's the kind of the heart of the script that I wrote to make the the lava lamp plots, but but I've kind of stripped a little bit out of it, put a few extra comments in so that when people do get on GitHub, then they can notice there's a bit of extra help in there just to see what's going on. So, I'm going to go through this step by step I'm going to flick about a little bit as well and go and you know, have a look at the websites and stuff just to show, you know, where's this? Where's this coming from?

Jamie Whyte  
So the first thing that we're going to do, we've got a completely fresh environment here. So the first thing we need to do is we need to instal it. So we need to add our library, which is the tidy verse. So we've already installed it. So I don't need to do that. If you're getting this from, from the GitHub repo, and you've never done this before, you will need to instal a package first. In in our studio, we can stick a hash in front of any any text, any line of text, and it will comment it out. So it won't run this block of text. These are useful for things like comments. Or if you if you're having problems when you're running something, you can stick a hash in front of it, and it won't run that little bit of text. So that bit of code. So it's kind of a useful way of dealing with stuff. The only way the only place that that those hashes do have kind of an influence within our studio, is if we wrap something in four hatches the beginning and the end. And what that does is that creates a little menu entry for it. So we've got a bit of a code navigator down here. So we can pop this and we can jump to different parts of the code. So anywhere that's got these four hashes wrapped around something that becomes a, almost like a chapter within the code, and we can we can, we can kind of jump around, which is a neat little trick. There's the thing that I find with with our studio is that there are there are lots of neat tricks that are kind of particularly well documented, or, you know, you can you might stumble across them, or see someone someone tweets about it. And you know, there's things like that, that are kind of, you know, that someone might find useful. So the first thing we're gonna do, so the second thing we're gonna do so if so, we're going to run this line by line. So the way to run things line by line in our studio is to go on the line and on a Mac, I'm doing command and Enter. And what we've now done, we've got no kind of confirmation of anything but we've now we've now added the like tidy verse to our our kind of environment here and so So the next thing we're gonna do is, we're going to just kind of rumble down through the code. And the first thing that we're going to do is going to get our indices of declaration data. So what we're going to do is I'm going to show you a couple of different ways of getting data into our our environment. So the first thing that we're going to do is get the AMD data we're going to use part of tidy verse. It's just a function called read CSV. So read underscore CSV. Now what this is going to do, the thing about read CSV is not only does it allow us to open up local files, but it also allows us to open up CSV files from the web. So initially, the deprivation data is stored is kind of, as I said, it's published by Ministry of Housing, Community, local government. So if I flick over to to Chrome, I can show that here. So they've got a site called Open Data communities. English indices of deprivation 2019. So there's a whole heap of data in here, which is the LSE is a deprivation of lots and lots of different things. mains. So I think you know, 1010 different domains of the indices, there's an overall one. And then there's ones relating to income employment education. There's different measures. So we've got the death cycle. So which kind of which 10% of the country has Ephraim fall into, we've got the overall rank and the score that's allocated to them. We've got one year's worth of data. But what we're really interested in here is this download the entire data set as a CSV button. Because we can click on this and we can get the get the get the address of that button. And because that downloads a CSV file, we can use that in our code here to say read the CSV file from this URL. So and what we're going to do is the kind of standard notation within R is to say is this kind of assignment operator here, which says the results of this, we're going to put into an object called IMD underscore data underscore LSI. So if I run this now, what we're going to see in our console on the on the right hand side got a bit of a our kind of arrow has gone, which means it's now thinking about doing something. So it's the art is now going over to that website. It's kind of it's effectively hitting that CSV button, and it's grabbing that CSV data. And then it's going to look for get it into into the format that we needed for, so that we can do some stuff with it. So we can see now that that's part of the column specification, it's had a bit of a guess that what it thinks the columns column types are based on on the kind of the contents of those columns. So we've now got that there. What we've also now got is when we said that that environment box was empty earlier on, we've now got an object in here. So we can see that we've now got ind data, Id underscore data underscore lso A, which is an object which has 985,320 observations, and it's got six variables. So we can kind of pop that and we can have a bit of a closer look at what's inside it. So we can view it within here. Or we can single click it And it will pop it up here for us. And we can see the contents of this file of the object now that we've loaded in here, so we can see the sorts of things that are in there, we've got feature code. So I know that these ees 0100, these are all codes of low super output areas in England, we've got a year, we've got the measurement type, so that the things that we saw before when we were looking at the, this page here, this is the contents of the data set. And this is how this is all all reflected in here. So this is in tidy format, which is kind of a format, which is for normalisation, I can't remember exactly what it is, but it's, but it's basically a single row per observation. So there's one value on each row. And this makes it easier for us to do stuff is very, very long. But we know that we can manipulate this data in a very particular way. And that there's kind of a tendency more towards publishing data in this way. I'm making it available in this way. So that the the kind of the preparatory steps today doing stuff with this data becomes a bit more standardised. And what that means is when we're when we're writing a script in our to do the processing is more reproducible and repeatable on other data sets, because a lot of the kind of a lot of the things are the same. And so it becomes less difficult to tweak your your script to make it relevant to another data set. So that's the data that we've got there. What we're also going to do is do the same thing, but that's about LSA data. So lower super output area, so 32,000 of these in the country, we're also going to get the local authority deprivation data. So the reason we're going to so it's exactly the same principle. We've got the same same different page on that on the government website, different link, but it's now going to grab the data. In fact, it's already done that similar data but local authority level. Now the reason that we want to do that is because we ultimately if you remember, on our lava lamp, plot the deprivation plot, we've got an overall sort of local local authorities from least deprived to most deprived And this is what allows us to do that by using that, that that kind of data, right, and but we're not, we're nowhere near there yet. Because all we've now got is we've got these two objects that neither than those of the other exists, we've not got any kind of nothing in there going on. So the final data set that we're going to get is our political control data. So if you remember, each of these, each of these shapes is coloured according to political control. So this is in with with, with English constituencies. There's kindof quite a good data set of MPs and the party that they belong to, and the constituents as they represent. What we're looking at here, though, is local authority. Now local authorities are a little bit more difficult, because there's no real data set and who can use in control of the local authority. So when we came to do this, we put out a bit of a call on Twitter. And I created a Google Sheet and so I know So I made a Google Sheet and said, I need a bit of help. If people can can put the controlling party of these local authorities, you know, if you know what it is, or if you mean you can live in it or work in it, then can we get the sheet populated, I managed to get some data from Wikipedia But generally, you know, it was this is this is kind of a nice example of, you know, getting something crowdsources quite a lot of these areas, there's sort of 300 or so of them. But we managed to get this filled out. Now, within our There used to be a library, which is called Google Sheets. And what that allowed us to do was to connect directly to a Google Sheet and download the contents of that into into an object the same way we as we've done with these sorts of things, but Google changed their API, and that broke the Google Sheets package. Now, I think it's been fixed but you have a chance to check that and kind of update stuff. And for the purposes of SSL, it's probably easier just to download. Download spreadsheet as a CSV file to my kind of local folders and import it that way, just, you know, partly to show you that you know that you don't have to download, you get things by URL, you can also get them from from your kind of local files. So that's what we're doing here is we've got this. So we're saying to create another another object, this one, you know, a data frame called political control. And we're going to assign into it the contents of this file. So if what I'm going to do is I'm just going to, we're going to ignore this thing for now. And we're just going to do that. So if I select all this, and I remap, then we can see in our console on the side, we've got political control paths with common specification columns, or ns local authority code or quota name tier, and then 20 1415 to 19, which is exactly what we've got in this, this sheet here. So it kind of reflects that entirely. But we don't really need all that. We don't for the purposes of this, we don't need 2014 to 2017 data We don't need the name. And we don't need to tear that is either. So what we're going to look at now is this thing here. So this is called a pipe. And this allows us it's part of the tidy verse. It's actually a separate package called mug Ritter. Because I think mug greets was an artist who did the pipe in a city in a peasant deep. I think it's nerd human. I don't really get it. But I think that's that's the idea behind it. But what it allows us to do is it allows us to chain together multiple tidy verse functions. So in this case, what we're doing here is we're saying, for palate for the poll, poll, underscore control objects, read our local file, our local CSV file, and then without skipping a beat, then do something else with it. So from the tidy verse, Then, we're then saying, select o and s, la code and 2019. So select is saying, select only those two columns. So because we're not interested in the rest of it, all we're interested in is the code And this this year's value, then we can do that. So this, this thing here is is quite a nice way of kind of stringing lots of things together in a way that that kind of it makes it a bit more efficient. And we'll see that in a little bit when we're doing some of the the kind of the more heavier Jui processing of the data. So instead of running just a political control, we can see here, we've got 420 observations of eight variables. If we run this again, but include everything. So this is going to run both of those lines, we can see that it's done that. And now we've got 420 observations of two variables. So if we open that up in our viewer appear, we can see we've got the O ns la code, and a 2019 value. So these are local authority codes. And this is your con lab or no of our control or independent, whatever it is. So close that script.

Jamie Whyte  
There's a few other things that we need to do now. So there's a session cemented as a session on statistical geography in a few weeks time Which is a rat's nest in this country are trying to work out how different things fit together, some things neatly fit inside each other, or other things don't there are some lookup tables exist, there's some that don't exist. So you have to infer stuff. Some things you can you can kind of do just by by text matching other things. You have to, you know, get GIS out and do the matching like that. But But for this, the reason I've done local authorities is because it's fairly straightforward. LSA is fit neatly into local authorities, local authorities fit neatly into regions. So it's kind of a, you know, this is quite a simplistic example about doing this. So what we're going to do is we're going to we're going to load our our look up files into into our object environment. So the first one that we're going to do is a look up from LS LA to LA. So lo su prep area to local authority. So this has come from Office for National Statistics on their kind of statistical geo portal, they publish this kind of stuff. So I can run that. That's command we can see in the console of that stuff. There. In our environment down here, we can see that we've now got NLU underscore LS la underscore LA. And we've got 3284 330 2844 observations of eight variables, we can have a look at that. And what we will see in here is that we've got an lso a code. And we've also got a local authority code, which is in here. So we can use this to match to look up and say which local authority does each individual low super app area fit into. And close that. And we've also want to look at the same thing, but looking at local authority to region. So we've run that and now we've got this LSU la region. If we have a look at that. Then you can see we've got the local authorities, and we've got which region they fall into codename so that gives us the platform. So we've now got these lookup files that allow us to match lower super output area, so local authority, or if we want to we can do it to region so that we could Very make those those plots for the regions of the of England close up.

Jamie Whyte  
So now we get onto the onto this kind of big chunk of text here. So this is a big script. So you'll see that you know, what we've got in here are the pipes. So we've essentially got, we've essentially chaining all of these different functions together where each step, the results of each step get passed into the next step. I personally find this much more readable than a load of separate functions, I find it much more intuitive to work out what's going on. So if I'm looking at trying to break down somebody else's code or my own code from six weeks ago, and then I can kind of get in and I can I can kind of understand what's going on this way, much easier than normally. But I think what we'll do, what we'll do here is we'll kind of step through this one bit at a time by just by selecting each part of it and we can show how this builds up our process and because what we ultimately want to end up with it Is it not 985,320 observations, because there's a lot of cruft in there that we need to get rid of, there's a lot of stuff that we don't need. When dealing with that kind of data. It's, you know, it all kind of handles okay, but it you know, it from a kind of good practice point of view, it's better to strip out anything that you know, that we don't need. So the first thing that we're going to do is just simply create a separate object. So we're going to keep our IMD data LSA objects, when a key back exactly as it is just in case we, as we're writing this, as well, as we're building this up, in case we make a mistake, we don't want to overwrite it because it's just a bit of a pain in the US a pin backside. So they'd have to go back and get, you know, kind of go and get the data again. So that's the first thing that we're going to do is create this new objects, which we've now got here. So we've got an object. This data frame looks exactly like that one, same number of observations, same number of variables. So the reason for that is because it is exactly the same. The next thing we're gonna do is if we want to open this up We can have a look at it. So we've got in here, we've got in this measurement column, we've got our ranks, we've also got these decimals. And I think we've also got scores as well. For the purposes of what we're doing today, though, we only really want ranks, so we can get rid of everything else. So the first step that we're going to do then, is apply filter. So this is a part of the tidy verse. That easy, so we just can script this in. So filter measurement. So that measurement is just this. If we go back here, that's this column name here. And we're saying is, so we're saying filter measurement where measurement is rank. So double double can have equal signs and then rang. So if we run that, what we should see down here is that this number of observations is going to drop by drop to a third of that value. So fingers crossed.

Jamie Whyte  
We run that and there it is. So it's going down to 30,000 28,440. So we've now only got racks in there now, but there's still other stuff in there that we've we've got You can see from the order of things in here that I've kind of written this as a go along as things have occurred to me, it would probably be better practice to kind of arrange this a little bit better. But you know, everyone has their own way of doing stuff.

Jamie Whyte  
So the next thing that we're gonna do is we're going to rename rename the, the indices of deprivation column, two domain, so we can see in here, spaces caused problems. So we've got this this column heading, which is, which is indices of deprivation, we want to rename that sub domain, and that's what the next thing does. So if we run kind of extend that to there, and we can run that this looks exactly the same. It's no different but if we preview it, then we can see that that's not what I that's interesting. I think I said the wrong thing. So.

Jamie Whyte  
So now we've got that column heading is now domain, rather than, rather than where it said indices of deprivation, this just makes it easier to do so further down the line. So, when we look at this, what we can see is, we've got in here, all the different domains of the indices of deprivation. So we've got the income domain, we've got the health domain, the education domain, we don't want all of these for this particular analysis. So what we're going to do is we're going to filter out so that we've only got the the index of multiple deprivation, so we can run map. And what we should see here is that this 32 brings in 28,000 is not going to drop down quite significantly. So if we select all that, and run that now, then we can see that we've now got 32,844 observations. So that kind of correlates nicely, because that's how many low superhot pairs are. So we've now got in our file, we've got early index and multiple deprivation and we've got one one row Per lower su crown area in the country. Now things are a bit tinier, we've only got the data that we want from this, what we now want to do is we want to, we want to link this to that lookup that we did before. So where we said, we brought in the lookup from lso a to local authority, we're now going to join that. So left underscore join is same as a sequel, SQL left join, for those that are familiar with that. So we're just going to bring in that other object, the lookup LSI LA, and we're going to join it on these two fields. So feature code from our IMD data and the LSI 11 code from the from the lookup. So if we run this now, then we've now got a match. So what if we if we preview this data, we can see we've got extra columns now. So each row kind of extends off to the side and what we now got, we've got CCGs in there, because that's what comes in the lookup file. And we've also got the local authority so we can start to get a bit of a sense of these LS LSI codes here are you know, they're not like useful for, you know, kind of when you're eyeballing stuff, but now we've got the LSI names in there. And we've got a local authority name so we can start to see where things are. Going back to our, our script, what we now want to do is where before, we said that we were getting to two indices of deprivation data is one LSI level, but one at local authority level, we're not going to join to that local authority dataset. So we've got the local authority codes that we've just joined to, and this is now going to give us the local authorities their rank of their average rank. So this is how deprived relatively deprived each local authority is that allows us to, to kind of show that in that order on the on the visualisation. So if we run that, takes a bit of time. What we can now see is this data we now have extra information on the rank of average rank of this other dataset. What we can then do is another rename step. So we'll skip, because we've done that once already under the filter, so the LA domain. So again, for the for the local authority, we only want to get the index and multiple deprivation. And we only want rank of average rank. So in the local authority data, we've got a lot of data in there that similar similar to the other one, no, we don't, we don't necessarily want to run that. We've also got a bit of a rogue column name that goes in so if we say we want to rename that as well. So if we run this, we've now got our dates are in here. There's a lot in that we can have, we're kind of, but we're good to go, you know, we've got we've got all our local authority data, we've got the ranks of average rank. For our local authority, we've got our local authority names. So the final join, that we want to do to get extra information into here is to that political control data set. So because we've got the local authority codes in both datasets, same as before, we're doing that SQL type left join. And we can run that. And that should be done. So then hopefully, we've now got, we've got all our all our kind of deprivation type information. And we've also got the political control of the local authority that each lowest super area sits in. There's a couple more steps to this.

Jamie Whyte  
So we want to rename that poll underscore control column. So this, the column 2019, to be polled underscore control underscore 2019, just so that we know what it is that we're talking about when we come back and look at the data. We're going to do Another join this time to region because for the purposes of this, it kind of felt better that we just focus on one region rather than the whole, the whole thing because the visualisation can be a bit a bit difficult to see. So let's do that now.

Jamie Whyte  
And in our data then so we've got, we should have our kind of region at the end of it now. So we've got the region here, Northwest East of England. So these steps, these aren't just applicable to the indices of deprivation data, this can be applied to anything. So once you've got your data in this format, this stuff is reusable. So you can kind of you know, copy and paste it you can, you can create a function that does it know that was kind of going a bit bit too deep. But the principle of this is that this is all kind of repeatable, and once you've done it once, it you know, it really does kind of save time in the in the long run So the next thing that we need is something that we've not yet seen, which is new tape. So new tape means we're going to change a, we're going to change a column. So in this case, we're going to add a new column, which is the virgin tile. And the virgin tile is a bit like a kind of a desalle, or percentile, but it's in sort of 5% groups. So what that's what we want to want to work out from the, from the rank of each other, so we want to know which virgin tile do they fit into. And we chosen this because it was a, it was a it gave Thomas they gave the best looking shapes for the visualisation. So this was you know, a bit of tracking of trial and error as to what works best. But so mutate will just take you through a particular calculation, which in this case, is the entire function. So it's going to calculate the N cells and being the B percentile, it could be could be Desa. In this case, you know, we're gonna have a Gentile using that value, x column, which is the rank of the In the lowest to prep area, and we want to take kind of put it into into one of 20 bins. So if we run that we should see our virgin South column. Then today, we've got kind of numbers between one and 20. And then the final couple of things that we need to do this, this removes the silly aisles, because the silly eyes don't have any data with them. And they cause problems. So they, they kind of, they need to remove. And then this, this filter here is one that just restrict it to the northwest of England because it kind of takes it down from 30,000 lsps down to a much more manageable number when we're looking at just going to show in a visualisation like this. So if we run that what we will eventually see is that our objects down here now has 4497 observations. Which is the number of lows and proper areas in the Northwest. If we do this, then we've got only Northwest region. And you know, you can see the local authorities that we've got in there, and noseley, Wigan, all that kind of stuff. The very, very last thing that we do in terms of processing the data then is this final select, which we've got 24 fields in here, 24 different columns, and we don't need that many. So we strip out all of the ones that we don't need, just for the sake of being tidy. So if we, if we now run that, we're only going to keep that the LS la code, local authority code, the local authority name, that virgin tail value, the political control, and the rank of average rank. These are the things that we need to make our visualisation. So if we run that, and we jump back here, then we can see we've just got those columns that we want. And that's pretty much it. So working through it step by Step, you know, it's kind of it's taken us maybe 15 minutes to go through that, but what we can actually do is, we can just run this. And that will run the whole block from start to finish. So all of that processing, once we've written it now that took kind of five seconds to run. So that kind of, you know, the idea of being able to lift this and apply it to the date. So probably the beginning principles to the datasets is that you can really kind of see that if you're doing this thing, this sort of thing frequently, or there's lots of people that are doing it, then published in this kind of thing, you know, really kind of helps with efficiencies both for yourself and for the people. So that's the process, isn't it? So we've got the data into the right shape one, this is the kind of thing that we need for for making a visualisation. So the next step then, is to actually visualise it so we still got a bit of extra stuff that we need to do in order to make our visualisation. The first thing we've got our our political control in there, but what our doesn't know is it doesn't know that you know, we weren't If it's labour, we want it to be coloured in labor's party colour. So we need to tell it that that's what we want it to do. So this is creating an object called pal control. So palette control, which says, If you know it creates like a little function that if someone passes in lab, then it's going to return this hex value. So this hex value is, is the hex value of the Labour Party. So you can get these off. Wikipedia has these and we can kind of stick it into into duckduckgo and I'm hoping it just gives a it also shows you the colour there. So you can see what he's looking at, you know, you can get this kind of stuff from if you're using Photoshop or the colour pickers or that kind of stuff. But that's what we're essentially telling this to do is where it sees any of these values. That's the that's the kind of the column that it needs to swap in. So we're going to do this now we'll just run this so we need to, we need to run it we need to load in so we've initialised this subject so you can see here we've got these values. Paul controlling gives us that give Look at power controller, it gives us that that look up there. Next thing that we want to do is we need to sort our data frame so that the minute it's on sorter will be sorted according to maybe the lso a code. But what we want to do is we want to in our visualisation, we want to sort it by that local authority. deprivation score. So that's what we're telling it to do here. So we're saying our object ind data LSI, LA, this, the dollar sign here, then says, you know, that's the, that's our data frame. This is a specific column in a data frame. So this is one that doesn't exist yet. So we're creating it because it doesn't exist, we're going to create it. And we're going to assign into that, we're going to assign the values of the local authority 90 name, but sorted, so we're reordering it by the rank of average rank. So this is just going to add an extra column, which has this kind of this implicit source and applied based on that based on that rank, and we need that for our visualisation. So if we run that, then we've got that in there. Now. There's no kind of the change in here. I guess, is We've got an extra extra variable in there, which is this secondary column of the local authority name, we've given it the kind of an extension of underscore A and D. Because, you know, we know that that's what that's the sort that we want for the indices of deprivation. So that's all our Data Prep done. We're good to go now with a visualisation. So what we're going to use for this is part of the tidy verse. So it's called GG plot, and GG plot, I think GG stands for the grammar of graphics. It's kind of a an ordered, structured way of creating different graphics. You can make wine charts, you can make bar charts, you can do histograms, you can do scatter plots, loads of things you can do with this. For this, what we're doing is we're doing a violin plot. So I've kind of done in the first instance, a bit of a test one. So this is kind of minimal information that we need in order to make our our you know, whether it's, you know, kind of violin plot lava lamp plot. And what we're essentially saying this, we're going to create an object called test violin plot and into that object. We're then going to assign GG plot objects. So and within there, then we are going to use this data set. So this is the data set that we created, I am the underscore. So this is the thing that we worked hard to get into the right shape. So this is in the right shape for, for GG plot so it understands it. And we're going to set the aesthetics for this GG plot. And to do this, we're going to say along the x axis, we want local authority names and a y axis, we want that virgin tail value that can have a count of how many is in each virgin cell value. And we're going to fill it according to the political control thing that we got so conservative our labour, this thing here is identical to the pipe function from before, but this was invented before the pipe came along. So I think it will be updated at some point, but it's essentially chaining different things together. So we're then going to say we're going to facet wrap this object so what this says This tells, GG plot to do is to create Make one little chart that each area. And we're gonna, we're gonna do that based on the local authority name with our IMD salt and we're going to do some other stuff with it. So we're going to tell it tell it what shape to be that maybe if we run it, and we can have a bit of a look and see what it actually looks like, I'll be the best thing to do. So we run that and then run our tests. So we run that so we load it into the subject, and then we view the objects and fingers crossed, this is gonna work. So what this is going to do is just going to work a little bit while it does everything that needs to do to make the plot and that's now done. So within our plots tab, what I'm hoping is that we're gonna see, okay, so we're gonna see a really basic unstyled Apart from that, that colour in violet, so you can see, now they're kind of it's sort of similar in some respects, but it's also very different. But you know that the principle holds and that we've got, you know, we still got Blackpool at this end. in Northwest, I think I can't see that because there's bars in the way. But there's if I lifted up, we've got the river valley is there is the least deprived local authority in there in the northwest and we've got everything in between we've got it covered. So we've got a bit of work to do with this. But what we can see is that that facet wrap, this tells it to do this, and put these things side by side. And we know that the end call here tells it to put 16 of them. This is trial and error. So you kind of choose what works best. Depending on how many things you've got 16 in a row is seems to be a good amount for this. We've got the line colour for our, our kind of our shape, so that that's what that's telling that to do. And then this is the bit that we're saying to colour the colour of the plot. So we've got our fill here. That's the field that's determining that and our fill here. Saying, use this to look up, if you remember that poll control that we had before. So where it's lab, then it returns that colour. And that's how this colouring works. So this is kind of reproducible, you know, you can kind of, you can kind of use these principles to create any violin plot. For the purposes of what we actually were trying to do, and so which is getting close, getting closer to this kind of it, we've got a bit more styling to do so within GG plot, you'll see that this bit is mostly the same, we've added a gg title in here. So I've added the title. We've hidden the lines, because we don't want them around the around the plots. And then we've added this theme stuff. And this is the this is the thing that starts to make a big differences is and this is a this would be a talk in its own right, I think, understanding how the themes work, but the documentation is really really good around this in that you can kind of you can control all sorts of things. So if we have I'm going to run this now. And we can see that that's run. And if we now preview that, that hopefully should, should appear in our plot view here.

Jamie Whyte  
So here we go. So you can see now that with the themes with the styling that we've done here, we've got a little bit closer to what it is that we're trying to get to. So if I kind of condense this slightly, the plot zoom or refresh, and you know, you'll see that the shapes are kind of quite similar to, to what we've got there. I suppose the final thing to note is that what we then do with this, this is, you know, another function, the final function that we can run, and this will save this as a ping. So we can we can run that. And that will save our objects we can set how tall and how wide we want it, the units, what we want to call it, and that's our kind of data source and within our files, then what you will see is if we go back up to here within our working directory, we've got deprivation pot PNG, and we should be able to open up And where that will open actually looking somewhere, probably some of that that's gonna eat my battery, there we go. So that's now there, and we can kind of email or do whatever we want with it. Finally, the last thing that I guess is that we could also we don't have to do this into PNG, we can also output it as, as SVG. And if we do it as SVG, that means we can then take it into Illustrator, or we can take it into Inkscape, or whatever, you can have favourite vector graphics packages, and make those changes. So you can do all kinds of different things to it, to turn it into, you know, what is kind of the kind of the final output adding little bits of no other touches into it, just to make it that kind of presentation ready. And it's, you know, it's a big job once you've got the data. And you can rerun it, rerun it as many times as you want, and you can get to that point. So I think that that's probably it from me, everything's on GitHub. So you should be able to lift this take it and go and run it yourself now and it should work. And then no by all means feel free to change it. And you know share share with open at Manchester if you you know if you do manage to do some interesting stuff off the back of this and I guess we would love to hear about it.

Transcribed by https://otter.ai
